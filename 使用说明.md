# PPX 酷狗音乐下载器 - 使用说明

## 功能特性

- 🎵 **单曲下载**: 每首歌曲旁边都有独立的下载按钮
- 📋 **批量下载**: 在"全选"单选框旁边有"批量下载本榜单"按钮，一键下载当前榜单所有歌曲
- 🔍 **搜索下载**: 搜索结果页面支持搜索下载功能
- 🖥️ **桌面应用**: 基于 pywebview 的现代化桌面界面
- 🎨 **美观界面**: 注入的按钮具有现代化的设计风格
- 📁 **自动分类**: 下载的音乐按类型自动分类存储

## 使用方法

### 1. 运行主程序

```bash
python kugou_downloader.py
```

### 2. 运行调试版本（推荐）



### 3. 使用下载功能

#### 单曲下载
1. **等待页面加载**: 程序会自动打开酷狗音乐排行榜页面
2. **查看下载按钮**: 每首歌曲旁边会出现蓝色的"下载"按钮
3. **点击下载**: 点击任意歌曲旁的"下载"按钮即可下载该歌曲

#### 批量下载
1. **查看批量下载按钮**: 在"全选"单选框旁边会出现绿色的"批量下载本榜单"按钮
2. **点击批量下载**: 点击按钮即可下载当前榜单页面的所有歌曲
3. **查看进度**: 右上角会显示下载状态和进度

#### 搜索下载
1. **搜索歌曲**: 在搜索页面搜索歌曲
2. **查看下载按钮**: 搜索结果旁边会出现"下载"按钮
3. **点击下载**: 点击按钮会搜索并下载该歌曲

## 下载位置

下载的音乐文件会保存在程序目录下的 `downloads` 文件夹中：
- 单曲下载: `downloads/单曲下载/歌曲名.mp3`
- 批量下载: `downloads/榜单名称/歌曲名.mp3` (按榜单名称分类)
- 搜索下载: `downloads/搜索结果/歌曲名.mp3`

## 按钮说明

### 批量下载按钮
- **位置**: "全选"单选框旁边
- **颜色**: 绿色 (`#19be6b`)
- **功能**: 下载当前榜单页面的所有歌曲
- **效果**: 悬停时有动画效果
- **特点**: 只下载当前榜单，不下载其他榜单

### 单曲下载按钮
- **位置**: 每首歌曲旁边
- **颜色**: 蓝色 (`#2d8cf0`)
- **功能**: 下载单首歌曲
- **效果**: 悬停时颜色变深

### 状态显示
- **位置**: 右上角固定位置
- **功能**: 显示下载进度和结果
- **颜色**: 蓝色(进行中) / 绿色(成功) / 红色(失败)

## 技术实现

### JS注入逻辑

1. **智能选择器**: 使用多种CSS选择器来查找歌曲元素
2. **信息提取**: 自动提取歌曲名称和ID
3. **按钮创建**: 为每首歌曲创建独立的下载按钮
4. **批量下载**: 创建固定位置的批量下载按钮
5. **事件处理**: 处理点击事件并调用Python API

### 选择器策略

程序会尝试以下选择器来查找歌曲：
- `.pc_temp_songlist ul li` - 主要歌曲列表
- `.rank_songlist ul li` - 排行榜歌曲列表
- `.song_list ul li` - 歌曲列表
- `.list_content > li` - 搜索结果列表

### 按钮样式

#### 批量下载按钮特点：
- 绿色背景 (`#19be6b`)
- 白色文字，粗体
- 圆角边框，阴影效果
- 悬停时有动画效果

#### 单曲下载按钮特点：
- 蓝色背景 (`#2d8cf0`)
- 白色文字
- 圆角边框
- 悬停效果

## 问题诊断

### 如果按钮没有出现

1. **检查控制台输出**:
   - 是否显示 "JS注入测试开始..."
   - 是否显示 "找到 X 首歌曲"
   - 是否显示 "批量下载按钮已添加"

2. **手动测试JS注入**:
   在浏览器控制台中运行：
   ```javascript
   // 测试基本JS注入
   const testBtn = document.createElement('button');
   testBtn.textContent = '手动测试按钮';
   testBtn.style.cssText = `
       position: fixed;
       top: 100px;
       right: 20px;
       z-index: 99999;
       background: red;
       color: white;
       padding: 10px;
       border: none;
       border-radius: 5px;
       font-size: 14px;
   `;
   testBtn.onclick = function() {
       alert('手动测试成功！');
   };
   document.body.appendChild(testBtn);
   ```

3. **检查页面结构**:
   打开开发者工具，查看歌曲元素的结构，确认选择器是否正确。

### 如果下载失败

1. **检查网络连接**: 确保网络连接稳定
2. **检查API状态**: 运行 `python test_kugou_api.py` 测试API
3. **查看错误信息**: 控制台会显示具体的错误信息

## 测试功能

### 测试API功能
```bash
python test_kugou_api.py
```

### 测试批量下载功能
```bash
python test_batch_download.py
```

## 常见问题

### Q: 按钮没有出现
A: 运行调试版本 `python debug_kugou.py`，查看控制台输出

### Q: 批量下载按钮点击无反应
A: 检查是否成功调用了Python API，查看控制台错误信息

### Q: 下载失败
A: 检查网络连接和API状态，确认歌曲ID是否正确获取

### Q: 按钮样式不美观
A: 可以修改JS代码中的CSS样式来自定义按钮外观

## 下一步

1. 运行调试版本 `python debug_kugou.py`
2. 观察页面右上角是否出现绿色的"批量下载榜单"按钮
3. 观察每首歌曲旁边是否出现蓝色的"下载"按钮
4. 点击批量下载按钮测试功能
5. 点击任意单曲下载按钮测试功能
6. 检查下载文件夹确认文件是否正确保存

如果仍有问题，请提供：
- 控制台的完整输出
- 页面源代码的相关部分
- 具体的错误信息 